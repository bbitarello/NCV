##########################################
##	Bed Files for Go analyses, etc.###
##	For Joao                         #
##	Created: 22.07.2015
##	Last modified: 23.10.2015
##	Author: Barbara Bitarello       ##
##########################################

#To understand file names:

YRI refers to Yoruba, LWK to Luhya, etc, following 1000 Genomes nomenclature.

top816 refers to the lower 0.05% tail of the empirical Z-score (Corrected NCV), which yields 816 windows. After merging, this adds up to ~ 400 regions, and ~ 100 genes (this varies between data sets)

These files where generated elsewhere, and are copied here solely for the purpose of GO analyses.

AND means intersection

OR means union

to define "Afr", YRI and LWK were considered
to define "Eur", GBR and TSI were considered

e.g. YRIandLWKf0.4.genes.txt , means that the intersection of YRI feq=0.4 and LWK feq=0.4 genes was taken.


More info on how these files were generated can be found in /mnt/sequencedb/PopGen/barbara/scan_may_2014/10000_sims_per_bin/bedfiles/R_candidates_intersect_feqs_and_pops.r

The file I used for intersectBed (to get the gene names) was 
/mnt/sequencedb/PopGen/barbara/scan_may_2014/10000_sims_per_bin/ensembl_hg19.bed
#background file contains all genes for which there is at least one window overlapping its coordinates in our scan. This should be useful for GO analyses, whereby an appropriate background list of genes is useful.



scanned_windows_humans.bed   #coordinates of all scanned windows for the NCV paper.

#the other bed files with top816 in the name are the actual bedfiles for the candidate windows, before intersecting with ensembl annotations.
#To generate combined version i did the following.
bedtools intersect -wo -a m.YRI.top816.f0.5.bed -b m.LWK.top816.f0.5.bed > m.YRIandLWK.top816.f0.5.bed
bedtools intersect -wo -a m.TSI.top816.f0.5.bed -b m.GBR.top816.f0.5.bed > m.GBRandTSI.top816.f0.5.bed


bedtools intersect -wo -a m.YRI.top816.f0.4.bed -b m.LWK.top816.f0.4.bed > m.YRIandLWK.top816.f0.4.bed
bedtools intersect -wo -a m.TSI.top816.f0.4.bed -b m.GBR.top816.f0.4.bed > m.GBRandTSI.top816.f0.4.bed


bedtools intersect -wo -a m.YRI.top816.f0.3.bed -b m.LWK.top816.f0.3.bed > m.YRIandLWK.top816.f0.3.bed
bedtools intersect -wo -a m.TSI.top816.f0.3.bed -b m.GBR.top816.f0.3.bed > m.GBRandTSI.top816.f0.3.bed
#merge
mergeBed -i m.YRIandLWK.top816.f0.5.bed -nms > merged.YRIandLWK.top816.f0.5.bed
mergeBed -i m.GBRandTSI.top816.f0.5.bed -nms > merged.GBRandTSI.top816.f0.5.bed

bedtools intersect -wo -a merged.YRIandLWK.top816.f0.5.bed  -b merged.GBRandTSI.top816.f0.5.bed > m.YRIandLWKandGBRandTSI.top816.f0.5.bed

#merge
mergeBed -i m.YRIandLWKandGBRandTSI.top816.f0.5.bed -nms > merged.ALL.top816.f0.5.bed
#

annotations form ENSEMBL

bedtools intersect -wo -a merged.ALL.top816.f0.5.bed -b ../scan_may_2014/10000_sims_per_bin/ensembl_hg19.bed|awk '{print $9}'|sort|uniq -c

bedtools intersect -wo -a m.YRIandLWKandGBRandTSI.top816.f0.5.bed -b ../scan_may_2014/10000_sims_per_bin/ensembl_hg19.bed > top816.ALL.annoated.bed

#gencode
bedtools intersect -wo -a m.YRIandLWKandGBRandTSI.top816.f0.5.bed -b ../scan_may_2014/final_encode.bed > top816.ALL.annoated.gencode.bed

#just checking
grep protein_coding top816.ALL.annoated.gencode.bed |awk '{print $13}' |sort|uniq |wc
#     37      37     263
grep protein_coding top816.ALL.annoated.bed |awk '{print $13}' |sort|uniq |wc

#     37      37     263
grep protein_coding top816.ALL.annoated.bed |awk '{print $13}' |sort|uniq |wc

bedtools intersect -wo -a m.YRI.top816.f0.5.bed -b ../scan_may_2014/final_encode.bed > m.YRI.top816f0.5.intersect.gencode.bed


bedtools intersect -wo -a m.LWK.top816.f0.5.bed -b ../scan_may_2014/final_encode.bed  > m.LWK.top816f0.5.intersect.gencode.bed

bedtools intersect -wo -a m.GBR.top816.f0.5.bed -b ../scan_may_2014/final_encode.bed  > m.GBR.top816f0.5.intersect.gencode.bed

bedtools intersect -wo -a m.TSI.top816.f0.5.bed -b ../scan_may_2014/final_encode.bed  > m.TSI.top816f0.5.intersect.gencode.bed


#some ENCODE annotations

wget http://promoter.bx.psu.edu/ENCODE/predicted_enhancer_human.tar.gz
wget http://promoter.bx.psu.edu/ENCODE/predicted_promoter_human.tar.gz

 tar -zxvf predicted_promoter_human.tar.gz
 tar -zxvf predicted_enhancer_human.tar.gz

